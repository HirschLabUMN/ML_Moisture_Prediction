---
title: "NIR PCA"
author: "Michael Burns"
date: "12/19/2019"
output: html_document
---

```{r}
library(pls)
library(dplyr)
library(ggplot2)
library(reshape2)
library(Hmisc)
```

```{r}
nir_spectra<-read.csv("/Users/michael/Desktop/Grad_School/Research/Datasets/Machine Learning/Spectra_Data/spectra_train_set.csv", check.names = F)
for(i in 3:ncol(nir_spectra)){
  if(!is.double(nir_spectra[,i])){
    nir_spectra[,i]<-as.numeric(as.character(nir_spectra[,i]))
  }
}
head(nir_spectra)
dim(nir_spectra)
```

How correlated is moisture uptake with each of the wavelengths?  What about the wavelengths with each other?
```{r}
corrmat<-round(cor(nir_spectra[,c(3:ncol(nir_spectra))]),3)
corrmat_melt<-melt(corrmat)
ggplot(data = corrmat_melt, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
 Thats a lot of highly correlated data points. Although, the darkest parts seem to be along the edges where moisture uptake would be.
 
```{r}
spectra_cor_vect<-vector(length = ncol(nir_spectra)-3)
for(i in 4:ncol(nir_spectra)){
  spectra_cor_vect[i-3]<-cor(nir_spectra$Moisture_Avg, nir_spectra[,i])
}
hist(spectra_cor_vect, breaks = 50)
plot(spectra_cor_vect)
boxplot(spectra_cor_vect)
```
Moisture appears to be negatively correlated with all of the all of the wavelengths.

```{r}
spectra_pca<-prcomp(nir_spectra[4:ncol(nir_spectra)], center = T, scale. = T)
summary(spectra_pca)
```

```{r}
screeplot(spectra_pca, type = "l", npcs = 15, main = "Screeplot of the first 10 PCs")
abline(h = 1, col="red", lty=5)
legend("topright", legend=c("Eigenvalue = 1"),
       col=c("red"), lty=5, cex=0.6)

cumpro <- cumsum(spectra_pca$sdev^2 / sum(spectra_pca$sdev^2))*100
plot(cumpro[0:15], type = "l", xlab = "PC #", ylab = "Amount of explained variance", main = "Cumulative variance plot")
abline(h = 99, col="red", lty=5)
legend("bottomright", legend=c("Variance Explained = 99%"),
       col=c("red"), lty=5, cex=0.6)
```

According to the PCA work, 2 components will explain over 99% of the variation.


