---
title: "Honigs Regression for Moisture Uptake"
author: "Michael Burns"
date: "3/10/2020"
output: html_document
---

This R markdown file is to create a honigs regression model that will determine moisture uptake based on raw kernel NIR spectral data.  The reason I am trying to do this with honigs is to simply see how it performs compared to PLS. I figured that since Honigs is commonly used with NIR data for predictions, it must have some power that PLS does not.

Load the data:
```{r loading_data}
dataset <- read_xlsx("../Data/Spectra_Data/spectra_learning_sets.xlsx")
head(dataset)
```

Lets get rid of unneeded columns and change the name of Moisture_Avg to Moisture_Uptake
```{r prepping}
dataset_prepped <- dataset %>%
  select(-c(Env, Rep, Block, ERB_Group, Amylopectin_average, Ankom_Crude_Fiber_average, Ash, Crude.fat, 
            Crude.fiber, Fructose, Glucose, N_combustion_average, N_Kjeltec_average, Sucrose_average,
            Total_Sugars_average, Moisture, Protein_As_is, Fat_As_is, Fiber_As_is, Ash_As_is, Starch_As_is,
            DML_Percent)) %>%
  mutate(Moisture_Uptake = Moisture_Avg) %>%
  select(c(SampleID, Genotype, Moisture_Uptake, 3:143))
dataset_prepped
```

Now load the prospectr package that we will be using to clean up data and perform honigs regression.
```{r}
library(prospectr)
```

```{r tidying_data}
dataset_tidy <- dataset_prepped %>%
  pivot_longer(cols = -c(SampleID, Genotype, Moisture_Uptake), names_to = "Wavelength", 
               values_to = "Absorbance") %>%
  mutate(Wavelength = as.numeric(Wavelength)) 

dataset_tidy %>%
  filter(SampleID == "YC16:1004") %>%
  ggplot(aes(x = Wavelength, y = Absorbance))+
  geom_point()+
  theme(axis.text.x = element_text(angle = 45))
```

Since the data comes to us as every 5th waveband, and looks pretty smooth, I dont think we need to do any signal pre-processing to smooth things out.

```{r honigs}
dataset_honigs <- honigs(X = dataset_prepped[,c(4:144)], k = 100, type = "A")
```

I am not sure where to go from here.  From what I can tell, it seems that I should be able to write something like dataset[dataset_honigs$model,] to get all of the relevent rows that the honigs function said were significant.  But what to do with those I am unsure of.  I could probably put them in a pls model or some other kind of model, but I feel like there should be more to honigs regression than just a way to pick samples.





